---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Image } from "astro:assets";
import { getPosts } from "@/lib/hashnode";
import SignupForm from "@/components/SignupForm.astro";

export const prerender = true;

export async function getStaticPaths() {
	const posts = await getPosts();
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
---

<BaseLayout title={post.title} description={post.subtitle || ""}>
	<header class="relative">
		{
			post.coverImage && (
				<div class="h-[70vh] relative">
					<Image
						src={post.coverImage}
						alt={post.title}
						width={1920}
						height={1080}
						class="absolute inset-0 w-full h-full object-cover"
					/>
					<div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent" />
					<div class="absolute bottom-0 left-0 right-0 p-8">
						<div class="max-w-4xl mx-auto">
							<time class="text-white/80 text-sm">
								{new Date(post.publishedAt).toLocaleDateString(
									"en-GB",
									{
										day: "numeric",
										month: "long",
										year: "numeric",
									}
								)}
							</time>
							<h1 class="text-4xl md:text-5xl font-bold text-white mt-2">
								{post.title}
							</h1>
							{post.tags && post.tags.length > 0 && (
								<div class="flex gap-2 mt-4">
									{post.tags.map((tag) => (
										<span class="bg-white/10 text-white px-2 py-1 rounded-full text-sm">
											{tag.name}
										</span>
									))}
								</div>
							)}
						</div>
					</div>
				</div>
			)
		}
	</header>

	<article class="max-w-4xl mx-auto px-4 py-16">
		<div class="prose prose-lg max-w-none">
			<Fragment set:html={post.content || ""} />
		</div>

		<SignupForm location="post" />

		<div class="mt-8">
			<a
				href="/blog"
				class="inline-flex items-center text-green-600 hover:text-green-700"
			>
				‚Üê Back to Blog
			</a>
		</div>
	</article>
</BaseLayout>
