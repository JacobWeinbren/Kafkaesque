---
// src/pages/post/[slug].astro
import BaseLayout from "@/components/layout/BaseLayout.astro";
import SignupForm from "@/components/blog/SignupForm.astro";
import { getPosts, getPost } from "@/lib/hashnode";
import { formatDate } from "@/utils/helpers";
import { ChevronLeftIcon } from "@heroicons/react/24/outline";

export async function getStaticPaths() {
	const { posts } = await getPosts();
	return posts.map((post) => ({
		params: { slug: post.slug },
	}));
}

const { slug } = Astro.params;
const post = await getPost(slug);

if (!post) {
	return Astro.redirect("/404");
}
---

<BaseLayout title={post.title} description={post.subtitle}>
	<article class="max-w-4xl mx-auto px-6 py-4">
		{
			post.coverImage && (
				<div class="mt-8 mb-12 rounded-2xl overflow-hidden">
					<img
						src={post.coverImage}
						alt={post.title}
						width="1200"
						height="600"
						class="w-full h-[60vh] object-cover"
					/>
				</div>
			)
		}

		<header class="mb-12">
			<time class="text-green-600 font-medium">
				{formatDate(post.publishedAt)}
			</time>
			<h1 class="text-4xl md:text-5xl font-bold mt-4 mb-6">
				{post.title}
			</h1>
			{
				post.subtitle && (
					<p class="text-xl text-gray-600">{post.subtitle}</p>
				)
			}
		</header>

		<div class="prose prose-lg max-w-none">
			<Fragment set:html={post.content} />
		</div>

		<div class="mt-16">
			<SignupForm location="post" />
		</div>

		<div class="mt-12 pt-8 border-t border-gray-100">
			<a
				href="/blog"
				class="inline-flex items-center px-6 py-3 rounded-lg bg-green-50 text-green-600 hover:bg-green-100 transition-colors duration-150"
			>
				<ChevronLeftIcon className="w-5 h-5 mr-2" />
				Back to Blog
			</a>
		</div>
	</article>
</BaseLayout>

<style>
	.prose :global(ul) {
		@apply list-disc pl-8 my-6;
		list-style-position: outside;
	}

	.prose :global(li) {
		@apply my-2;
		padding-left: 0.5em;
	}

	.prose :global(img) {
		@apply rounded-xl shadow-lg;
	}

	.prose :global(pre) {
		@apply rounded-xl shadow-md bg-gray-900 text-gray-100;
	}

	.prose :global(a) {
		@apply text-green-600 hover:text-green-700 no-underline;
	}

	.prose :global(ol) {
		@apply list-decimal pl-8 my-6;
		list-style-position: outside;
	}

	.prose :global(blockquote) {
		@apply border-l-4 border-green-500 pl-4 italic;
	}

	.prose :global(h2) {
		@apply text-3xl font-bold mt-8 mb-4;
	}

	.prose :global(h3) {
		@apply text-2xl font-bold mt-6 mb-3;
	}

	.prose :global(p) {
		@apply mb-4;
	}
</style>
